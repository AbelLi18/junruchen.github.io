<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>D3 -- 拖拽</title>
  <style>
    * {
      box-sizing: border-box;
    }

    button {
      width: 100px;
      line-height: 36px;
      outline: none;
      border: 1px solid #58a;
      background-color: #fff;
      margin-bottom: 20px;
      cursor: pointer;
    }

    button:hover {
      color: #fff;
      background-color: #58a;
      transition: all .2s linear;
    }

    svg {
      border: 1px solid;
    }

    .drag-box {
      width: 440px;
      height: 440px;
    }
  </style>
</head>
<body>
<div class="d3-container">
  <div class="drag-box">
    <div class="drag-demo"></div>
  </div>
</div>
</body>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

  // 用户指定
  let circleData = [
    {
      cx: 150,
      cy: 200,
      r: 30
    },
    {
      cx: 250,
      cy: 200,
      r: 30
    }
  ]
  let color = ['#5588aa', '#ffbb33']

  // 全局变量
  let width = parseInt(d3.select('.drag-box').style('width'))
  let height = parseInt(d3.select('.drag-box').style('height'))
  let svg = d3.select('.drag-demo')
    .append('svg')
    .attr('width', width)
    .attr('height', height)
    .style('border', '1px solid #ccc')

  let drag = d3.drag()
    /*.subject((d) => {
      return {x: d.cx, y: d.cy}
    })*/
    .on('start', function () {
      console.log('start')
    })
    .on('end', function () {
      console.log('end')
    })
    .on('drag', function (d) {
      console.log('drag')
      d3.select(this)
        .attr('cx', d.cx = d3.mouse(this)[0])
        .attr('cy', d.cy = d3.mouse(this)[1])
    })

  svg.selectAll('circle')
    .data(circleData)
    .enter()
    .append('circle')
    .attr('cx', (d) => {
      return d.cx
    })
    .attr('cy', (d) => {
      return d.cy
    })
    .attr('r', (d) => {
      return d.r
    })
    .attr('fill', (d, i) => {
      return color[i]
    })
    .attr('stroke', 'none')
    .call(drag) //调用drag函数


</script>
</html>